<meta name="viewport" content="initial-scale=1.0, user-scalable=yes"/>

<script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD9XWGKCdbkwvHSDtoLWp-Ll4NRfGCjbL0&sensor=false">
</script>

<script type="text/javascript">
    function initialize() {
        var mapOptions = {
            center: new google.maps.LatLng(<%= @gps_data[4][1] %>, <%= @gps_data[4][2]%>),
            zoom: 12
        };

        var map = new google.maps.Map(document.getElementById("map-canvas"),
                mapOptions);

        var routeCoords = [];

        <% @gps_data.each_with_index do |d, i| %>
        <%= "routeCoords.push(new google.maps.LatLng(#{d[1]}, #{d[2]}));" %>

        <% if true %>
        (function () {
            <% if i == 0 %>
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(<%= d[1] %>, <%= d[2] %>),
                map: map,
                title: "position <%= i %>",
                icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
            });
            <% elsif i == @gps_data.length - 1 %>
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(<%= d[1] %>, <%= d[2] %>),
                map: map,
                title: "position <%= i %>",
                icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
            });
            <% else %>
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(<%= d[1] %>, <%= d[2] %>),
                map: map,
                title: "position <%= i %>",
                icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
            });
            <% end %>


            var infowindow = new google.maps.InfoWindow({
                content: "<div style='width: 300px; height: 300px;'>Position #<%= i%> at <%= Time.at(d[0].to_i).strftime("%m/%d/%Y %I:%M %p") %><br>Duration: <%= d[4]%> minutes<br><br><img width='300' src='<%= d[3] %>'> </div>"
            });

            google.maps.event.addListener(marker, 'click', function () {
                infowindow.open(map, marker);
            });

        })();
        <% end %>

        <% end %>

        var routePath = new google.maps.Polyline({
            path: routeCoords,
            geodesic: true,
            strokeColor: '#FF0000',
            strokeOpacity: 1.0,
            strokeWeight: 2
        });

        routePath.setMap(map);
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    $(document).foundation('orbit', {
      timer_speed: 0,
//       pause_on_hover: true,
//       resume_on_mouseout: false,
//       animation_speed: 500,
//       stack_on_small: true,
//       navigation_arrows: true,
//       slide_number: true,
//       container_class: 'orbit-container',
//       stack_on_small_class: 'orbit-stack-on-small',
//       next_class: 'orbit-next',
//       prev_class: 'orbit-prev',
//       timer_container_class: 'orbit-timer',
//       timer_paused_class: 'paused',
//       timer_progress_class: 'orbit-progress',
//       slides_container_class: 'orbit-slides-container',
//       bullets_container_class: 'orbit-bullets',
//       bullets_active_class: 'active',
//       slide_number_class: 'orbit-slide-number',
//       caption_class: 'orbit-caption',
//       active_slide_class: 'active',
//       orbit_transition_class: 'orbit-transitioning',
      bullets: false,
      timer: false,
//       variable_height: false,
//       before_slide_change: function(){},
//       after_slide_change: function(){}
    });

</script>
<a class="button left" style="width: 100%; margin-bottom: 0px; padding-bottom: 0px;" href="/">&nbsp;</a>
<div style="float: left; margin-top: 0px; padding-top: 0px; margin-bottom: 10px; margin-right: 10px;" id="map-canvas"></div>
<div>
  <div>
    <br><br><br>
    <span style="font-weight: bold"><%= @trip_data['name'] %></span><br><br>
    <%= @trip_data['description'] %>
    <br><br>
    <%= @trip_data['from'] %> to <%= @trip_data['to'] %>
    <br><br>
    <span class="label">Duration</span> <%= @trip_data['duration'].to_i / 60 %> minutes<br><br>
    <span class="label">Vehicle</span> <%= @trip_data['vehicle'] %>
    <br><br>
    <span class="label">Fuel Required</span> <%= @trip_data['fuel_required'] %> Liters<br><br>
  </div>
</div>
<div style="clear: both; margin-top: 10px; text-align: center">

</div>

<%
=begin %>
<ul class="slides" data-orbit>
  <% @gps_data.each_with_index do |d, i| %>
      <li marker_id="<%= i %>" class="marker_image" data-orbit-slide="<%= i %>">
        <img width="375" src="<%= d[3] %>">
        <dl class="orbit-caption">
            <dt>Position</dt>
                <dd>#<%= i %> at <%= Time.at(d[0].to_i).strftime("%m/%d/%Y %I:%M %p") %></dd>
            <dt>Duration</dt>
                <dd><%= d[4] %> minutes</dd>
        </dl>
      </li>
  <% end %>
</ul>
<%
=end %>